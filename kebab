#!/bin/bash

USERNAME="smrenato"  # â† Replace with your GitHub username

# Fetch all repositories including forks and archived
repos=$(gh repo list "$USERNAME" --limit 1000 --json name,isArchived,isFork -q '.[]')

echo "ğŸ”§ Renaming repositories to kebab-case..."
echo "========================================="

echo "$repos" | jq -c '.' | while read -r repo; do
    name=$(echo "$repo" | jq -r '.name')
    is_archived=$(echo "$repo" | jq -r '.isArchived')
    is_fork=$(echo "$repo" | jq -r '.isFork')

    # Convert to kebab-case
    kebab_name=$(echo "$name" | \
        sed -E 's/([a-z0-9])([A-Z])/\1-\2/g' | \
        tr ' _' '-' | \
        tr '[:upper:]' '[:lower:]')

    # Skip if name is already kebab-case
    if [ "$name" = "$kebab_name" ]; then
        echo "âœ… $name already uses kebab-case"
        continue
    fi

    echo "ğŸ” $name â†’ $kebab_name"
    echo "    ğŸ“¦ Archived: $is_archived"
    echo "    ğŸ´ Forked:   $is_fork"

    # Temporarily unarchive if needed
    if [ "$is_archived" = "true" ]; then
        echo "ğŸ“¤ Unarchiving $name..."
        gh repo unarchive "$USERNAME/$name" -y

        sleep 1
    fi

    # Rename the repository
    echo "âœï¸  Renaming $name â†’ $kebab_name..."
    gh repo rename -R "$USERNAME/$name" "$kebab_name"

    sleep 1

    # Re-archive if it was previously archived
    if [ "$is_archived" = "true" ]; then
        echo "ğŸ“¦ Re-archiving $kebab_name..."
        gh repo archive "$USERNAME/$kebab_name" -y
        sleep 1
    fi

    echo "âœ… Renamed $name â†’ $kebab_name"
    echo "-----------------------------------------"
done

echo "âœ… All renaming complete."